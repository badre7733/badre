<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Traffic Racer 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; }
    </style>
</head>
<body>

<script type="module">

import * as THREE from "https://unpkg.com/three@0.159.0/build/three.module.js";
import { GLTFLoader } from "https://unpkg.com/three@0.159.0/examples/jsm/loaders/GLTFLoader.js";

let scene, camera, renderer;
let car;
let obstacles = [];
let speed = 0.2;
let carX = 0;

init();
animate();

function init() {

    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, -12);
    camera.lookAt(0, 0, 0);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 2);
    light.position.set(5, 10, -5);
    scene.add(light);

    scene.add(new THREE.AmbientLight(0xffffff, 0.7));

    // Carretera
    const roadGeo = new THREE.PlaneGeometry(6, 2000);
    const roadMat = new THREE.MeshStandardMaterial({ color: 0x303030 });
    const road = new THREE.Mesh(roadGeo, roadMat);
    road.rotation.x = -Math.PI / 2;
    scene.add(road);

    // Cargar coche
    const loader = new GLTFLoader();
    loader.load(
        "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/SimpleCar/glTF/SimpleCar.gltf",
        (gltf) => {
            car = gltf.scene;
            car.scale.set(0.9, 0.9, 0.9);
            car.position.set(0, 0.4, 0);
            scene.add(car);
        }
    );

    // Obstáculos
    for (let i = 0; i < 10; i++) {
        const box = new THREE.Mesh(
            new THREE.BoxGeometry(1, 1, 2),
            new THREE.MeshStandardMaterial({ color: 0xff0000 })
        );
        box.position.set((Math.random()*4)-2, 0.5, -50 - i*40);
        scene.add(box);
        obstacles.push(box);
    }

    // Teclado
    window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft" || e.key === "a") carX -= 0.3;
        if (e.key === "ArrowRight" || e.key === "d") carX += 0.3;
    });

}

function animate() {
    requestAnimationFrame(animate);

    if (car) {
        carX = THREE.MathUtils.clamp(carX, -2.2, 2.2);
        car.position.x += (carX - car.position.x) * 0.2;
    }

    // Obstáculos
    for (let obs of obstacles) {
        obs.position.z += speed + 0.1;
        if (obs.position.z > 5) {
            obs.position.z = -200;
            obs.position.x = (Math.random()*4)-2;
        }
    }

    renderer.render(scene, camera);
}

</script>

</body>
</html>
